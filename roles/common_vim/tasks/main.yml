- name: Git clone/pull {{ git_electricboogaloo_vim }}
  ansible.builtin.git:
    repo: "{{ git_electricboogaloo_vim }}"
    dest: "{{ path_projects }}/electric-boogaloo.vim"

- name: Create directories under {{ path_vim }}
  ansible.builtin.file:
    path: "{{ item }}"
    state: directory
    mode: 0700
  loop:
    - "{{ path_vim }}"
    - "{{ path_vim }}/backup"
    - "{{ path_vim }}/swap"
    - "{{ path_vim }}/undo"
    - "{{ path_vim_pack_ggustafsson }}"
    - "{{ path_vim_pack_others }}"

- name: Create symbolic links to Dot-Files, Vim colorscheme, etc
  ansible.builtin.file:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    state: link
  loop:
    - src: "{{ path_dotfiles }}/vimrc"
      dest: "{{ path_home }}/.vimrc"
    - src: "{{ path_dotfiles }}/vim/after"
      dest: "{{ path_vim }}/after"
    - src: "{{ path_dotfiles }}/vim/templates"
      dest: "{{ path_vim }}/templates"
    - src: "{{ path_projects }}/electric-boogaloo.vim"
      dest: "{{ path_vim_pack_ggustafsson }}/electric-boogaloo.vim"
    - src: "{{ path_home }}/.local/share/fzf"
      dest: "{{ path_vim_pack_others }}/fzf"

- name: Git clone/pull misc Vim plugins
  ansible.builtin.git:
    repo: "{{ item.url }}"
    dest: "{{ path_vim_pack_others }}/{{ item.name }}"
  loop:
    - name: ale
      url: https://github.com/dense-analysis/ale.git
    - name: ansible-vim
      url: https://github.com/pearofducks/ansible-vim.git
    - name: fzf.vim
      url: https://github.com/junegunn/fzf.vim.git
    - name: vim-mundo
      url: https://github.com/simnalamburt/vim-mundo.git

    - name: fern.vim
      url: https://github.com/lambdalisue/fern.vim.git
    - name: fern-hijack.vim
      url: https://github.com/lambdalisue/fern-hijack.vim.git
    - name: fern-git-status.vim
      url: https://github.com/lambdalisue/fern-git-status.vim.git

    - name: vim-commentary
      url: https://github.com/tpope/vim-commentary.git
    - name: vim-endwise
      url: https://github.com/tpope/vim-endwise.git
    - name: vim-repeat
      url: https://github.com/tpope/vim-repeat.git
    - name: vim-speeddating
      url: https://github.com/tpope/vim-speeddating.git
    - name: vim-surround
      url: https://github.com/tpope/vim-surround.git
  notify: generate tags

- name: Get stats on {{ path_vimgo }}
  ansible.builtin.stat:
    path: "{{ path_vimgo }}"
  register: vim_go_plugin

- name: Install vim-go at {{ path_vimgo }}
  block:
    - name: Fetching https://api.github.com/repos/fatih/vim-go/releases/latest
      ansible.builtin.uri:
        url: https://api.github.com/repos/fatih/vim-go/releases/latest
        return_content: true
      register: release
      failed_when: release.json.zipball_url is not defined

    - name: Fetching {{ release.json.zipball_url }}
      ansible.builtin.get_url:
        url: "{{ release.json.zipball_url }}"
        dest: "{{ path_vimgo_zip }}"
        mode: 600
      when: release.json.zipball_url is defined

    - name: Extract file {{ path_vimgo_zip }}
      ansible.builtin.unarchive:
        src: "{{ path_vimgo_zip }}"
        dest: /tmp
        remote_src: true
        list_files: true
      register: unarchive
      when: release.json.zipball_url is defined

    - name: Copy /tmp/{{ unarchive.files[0] }} to {{ path_vimgo }}
      ansible.builtin.copy:
        src: /tmp/{{ unarchive.files[0] }}
        dest: "{{ path_vimgo }}"
        remote_src: true
        mode: 0700
      when: unarchive.changed
  notify: generate tags
  when: vim_go_plugin.stat.exists == false
