- name: Upgrade all Pacman packages
  community.general.pacman:
    update_cache: yes
    upgrade: yes
  become: yes
  register: pacman

- name: "Upgrade all Pacman packages : debug"
  ansible.builtin.debug:
    var: pacman.packages

# TODO: Adjust and enable after playing around with Docker.
#- name: Install misc Pacman packages
#  community.general.pacman:
#    pkg:
#      - x
#    state: latest
#  become: yes
#  register: pacman
#
#- name: "Install misc Pacman packages : debug"
#  ansible.builtin.debug:
#    var: pacman.packages

- name: Install misc Pip packages
  ansible.builtin.pip:
    name:
      - ansible
      - ansible-lint
      - flake8
      - pip
    state: latest
  register: pip

# FIXME: ansible.builtin.pip only returns useless info...
- name: "Install misc Pip packages : debug"
  ansible.builtin.debug:
    var: pip.name


- name: Set AllowUsers in /etc/ssh/sshd_config
  ansible.builtin.lineinfile:
    path: /etc/ssh/sshd_config
    regexp: '^AllowUsers'
    line: "AllowUsers {{ ansible_env.USER }}"
    validate: /usr/sbin/sshd -T -f %s
  notify: restart sshd
